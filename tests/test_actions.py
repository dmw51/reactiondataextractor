import pytest

import numpy as np
import matplotlib.pyplot as plt

from models.segments import Rect, Panel
from models.reaction import ReactionStep, Reactant, Product
from models.arrows import SolidArrow
from models.utils import Line, Point

from actions import find_nearby_ccs, extend_line, match_function_and_smiles

def test_extend_line_horizontal():
    line = Line([Point(194, 338), Point(194, 339), Point(194, 340), Point(194, 341), Point(194, 342), Point(194, 343), Point(194, 344), Point(194, 345), Point(194, 346), Point(194, 347), Point(194, 348), Point(194, 349), Point(194, 350), Point(194, 351), Point(194, 352), Point(194, 353), Point(194, 354), Point(194, 355), Point(194, 356), Point(194, 357), Point(194, 358), Point(194, 359), Point(194, 360), Point(194, 361), Point(194, 362), Point(194, 363), Point(194, 364), Point(194, 365), Point(194, 366), Point(194, 367), Point(194, 368), Point(194, 369), Point(194, 370), Point(194, 371), Point(194, 372), Point(194, 373), Point(194, 374), Point(194, 375), Point(194, 376), Point(194, 377), Point(194, 378), Point(194, 379), Point(194, 380), Point(194, 381), Point(194, 382), Point(194, 383), Point(194, 384), Point(194, 385), Point(194, 386), Point(194, 387), Point(194, 388), Point(194, 389), Point(194, 390), Point(194, 391), Point(194, 392), Point(194, 393), Point(194, 394), Point(194, 395), Point(194, 396), Point(194, 397), Point(194, 398), Point(194, 399), Point(194, 400), Point(194, 401), Point(194, 402), Point(194, 403), Point(194, 404), Point(194, 405), Point(194, 406), Point(194, 407), Point(194, 408), Point(194, 409), Point(194, 410), Point(194, 411), Point(194, 412), Point(194, 413), Point(194, 414), Point(194, 415), Point(194, 416), Point(194, 417), Point(194, 418), Point(194, 419), Point(194, 420), Point(194, 421), Point(194, 422), Point(194, 423), Point(194, 424), Point(194, 425), Point(194, 426), Point(194, 427), Point(194, 428), Point(194, 429), Point(194, 430), Point(194, 431), Point(194, 432), Point(194, 433), Point(194, 434), Point(194, 435), Point(194, 436), Point(194, 437), Point(194, 438), Point(194, 439), Point(194, 440), Point(194, 441), Point(194, 442), Point(194, 443), Point(194, 444), Point(194, 445), Point(194, 446), Point(194, 447), Point(194, 448), Point(194, 449), Point(194, 450), Point(194, 451), Point(194, 452), Point(194, 453), Point(194, 454), Point(194, 455), Point(194, 456), Point(194, 457), Point(194, 458), Point(194, 459), Point(194, 460), Point(194, 461), Point(194, 462), Point(194, 463), Point(194, 464), Point(194, 465), Point(194, 466), Point(194, 467), Point(194, 468), Point(194, 469), Point(194, 470), Point(194, 471), Point(194, 472), Point(194, 473), Point(194, 474), Point(194, 475), Point(194, 476), Point(194, 477), Point(194, 478), Point(194, 479), Point(194, 480), Point(194, 481), Point(194, 482), Point(194, 483), Point(194, 484), Point(194, 485), Point(194, 486), Point(194, 487), Point(194, 488), Point(194, 489), Point(194, 490), Point(194, 491), Point(194, 492), Point(194, 493), Point(194, 494), Point(194, 495), Point(194, 496), Point(194, 497), Point(194, 498), Point(194, 499), Point(194, 500), Point(194, 501), Point(194, 502), Point(194, 503), Point(194, 504), Point(194, 505), Point(194, 506), Point(194, 507), Point(194, 508), Point(194, 509), Point(194, 510), Point(194, 511), Point(194, 512), Point(194, 513), Point(194, 514), Point(194, 515), Point(194, 516), Point(194, 517), Point(194, 518), Point(194, 519), Point(194, 520), Point(194, 521), Point(194, 522), Point(194, 523), Point(194, 524), Point(194, 525), Point(194, 526), Point(194, 527), Point(194, 528), Point(194, 529), Point(194, 530), Point(194, 531), Point(194, 532), Point(194, 533), Point(194, 534), Point(194, 535), Point(194, 536), Point(194, 537), Point(194, 538), Point(194, 539), Point(194, 540), Point(194, 541), Point(194, 542), Point(194, 543), Point(194, 544), Point(194, 545), Point(194, 546), Point(194, 547), Point(194, 548), Point(194, 549), Point(194, 550), Point(194, 551), Point(194, 552), Point(194, 553), Point(194, 554), Point(194, 555), Point(194, 556), Point(194, 557), Point(194, 558), Point(194, 559), Point(194, 560), Point(194, 561), Point(194, 562), Point(194, 563), Point(194, 564), Point(194, 565), Point(194, 566), Point(194, 567), Point(194, 568), Point(194, 569), Point(194, 570), Point(194, 571), Point(194, 572), Point(194, 573), Point(194, 574), Point(194, 575), Point(194, 576), Point(194, 577), Point(194, 578), Point(194, 579), Point(194, 580), Point(194, 581), Point(194, 582), Point(194, 583), Point(194, 584), Point(194, 585), Point(194, 586), Point(194, 587), Point(194, 588), Point(194, 589), Point(194, 590), Point(194, 591), Point(194, 592), Point(194, 593), Point(194, 594), Point(194, 595), Point(194, 596), Point(194, 597), Point(194, 598), Point(194, 599), Point(194, 600), Point(194, 601), Point(194, 602), Point(194, 603), Point(194, 604), Point(194, 605), Point(194, 606), Point(194, 607), Point(194, 608), Point(194, 609), Point(194, 610), Point(194, 611), Point(194, 612), Point(194, 613), Point(194, 614), Point(194, 615), Point(194, 616), Point(194, 617), Point(194, 618), Point(194, 619), Point(194, 620), Point(194, 621), Point(194, 622), Point(194, 623), Point(194, 624), Point(194, 625), Point(194, 626), Point(194, 627), Point(194, 628), Point(194, 629), Point(194, 630), Point(194, 631), Point(194, 632), Point(194, 633), Point(194, 634), Point(194, 635), Point(194, 636), Point(194, 637), Point(194, 638), Point(194, 639), Point(194, 640), Point(194, 641), Point(194, 642), Point(194, 643), Point(194, 644), Point(194, 645), Point(194, 646), Point(194, 647), Point(194, 648), Point(194, 649), Point(194, 650), Point(194, 651), Point(194, 652), Point(194, 653), Point(194, 654), Point(194, 655), Point(194, 656), Point(194, 657), Point(194, 658), Point(194, 659), Point(194, 660), Point(194, 661), Point(194, 662), Point(194, 663)])

    assert extend_line(line) == (Point(194, 208), Point(194, 793))


def test_extend_line_vertical():
    line = Line([Point(x, 300) for x in range(400, 650)])
    extension = int(line.pixels[0].separation(line.pixels[-1]) * 0.4)

    assert extend_line(line, extension) == (Point(301, 300), Point(748, 300))

def test_extend_line_slope1():
    coord_range = range(400, 650)
    line = Line([Point(x+100,y) for x,y in zip(coord_range, coord_range)])


    assert extend_line(line) == (Point(360, 260), Point(889, 789))


def test_find_nearby_ccs_structures():
    structures = [Panel(left=767, right=953, top=177, bottom=312), Panel(left=679, right=888, top=23, bottom=115),
                  Panel(left=0, right=129, top=144, bottom=237), Panel(left=228, right=279, top=158, bottom=229),
                  Panel(left=338, right=667, top=191, bottom=201), Panel(left=805, right=888, top=385, bottom=407)]
    arrow_pixels = [(191, 649), (191, 650), (191, 651), (191, 652), (192, 650), (192, 651), (192, 652), (192, 653),
                        (192, 654), (192, 655), (193, 650), (193, 651), (193, 652), (193, 653), (193, 654), (193, 655),
                        (193, 656), (193, 657), (193, 658), (193, 659), (194, 338), (194, 339), (194, 340), (194, 341),
                        (194, 342), (194, 343), (194, 344), (194, 345), (194, 346), (194, 347), (194, 348), (194, 349),
                        (194, 350), (194, 351), (194, 352), (194, 353), (194, 354), (194, 355), (194, 356), (194, 357),
                        (194, 358), (194, 359), (194, 360), (194, 361), (194, 362), (194, 363), (194, 364), (194, 365),
                        (194, 366), (194, 367), (194, 368), (194, 369), (194, 370), (194, 371), (194, 372), (194, 373),
                        (194, 374), (194, 375), (194, 376), (194, 377), (194, 378), (194, 379), (194, 380), (194, 381),
                        (194, 382), (194, 383), (194, 384), (194, 385), (194, 386), (194, 387), (194, 388), (194, 389),
                        (194, 390), (194, 391), (194, 392), (194, 393), (194, 394), (194, 395), (194, 396), (194, 397),
                        (194, 398), (194, 399), (194, 400), (194, 401), (194, 402), (194, 403), (194, 404), (194, 405),
                        (194, 406), (194, 407), (194, 408), (194, 409), (194, 410), (194, 411), (194, 412), (194, 413),
                        (194, 414), (194, 415), (194, 416), (194, 417), (194, 418), (194, 419), (194, 420), (194, 421),
                        (194, 422), (194, 423), (194, 424), (194, 425), (194, 426), (194, 427), (194, 428), (194, 429),
                        (194, 430), (194, 431), (194, 432), (194, 433), (194, 434), (194, 435), (194, 436), (194, 437),
                        (194, 438), (194, 439), (194, 440), (194, 441), (194, 442), (194, 443), (194, 444), (194, 445),
                        (194, 446), (194, 447), (194, 448), (194, 449), (194, 450), (194, 451), (194, 452), (194, 453),
                        (194, 454), (194, 455), (194, 456), (194, 457), (194, 458), (194, 459), (194, 460), (194, 461),
                        (194, 462), (194, 463), (194, 464), (194, 465), (194, 466), (194, 467), (194, 468), (194, 469),
                        (194, 470), (194, 471), (194, 472), (194, 473), (194, 474), (194, 475), (194, 476), (194, 477),
                        (194, 478), (194, 479), (194, 480), (194, 481), (194, 482), (194, 483), (194, 484), (194, 485),
                        (194, 486), (194, 487), (194, 488), (194, 489), (194, 490), (194, 491), (194, 492), (194, 493),
                        (194, 494), (194, 495), (194, 496), (194, 497), (194, 498), (194, 499), (194, 500), (194, 501),
                        (194, 502), (194, 503), (194, 504), (194, 505), (194, 506), (194, 507), (194, 508), (194, 509),
                        (194, 510), (194, 511), (194, 512), (194, 513), (194, 514), (194, 515), (194, 516), (194, 517),
                        (194, 518), (194, 519), (194, 520), (194, 521), (194, 522), (194, 523), (194, 524), (194, 525),
                        (194, 526), (194, 527), (194, 528), (194, 529), (194, 530), (194, 531), (194, 532), (194, 533),
                        (194, 534), (194, 535), (194, 536), (194, 537), (194, 538), (194, 539), (194, 540), (194, 541),
                        (194, 542), (194, 543), (194, 544), (194, 545), (194, 546), (194, 547), (194, 548), (194, 549),
                        (194, 550), (194, 551), (194, 552), (194, 553), (194, 554), (194, 555), (194, 556), (194, 557),
                        (194, 558), (194, 559), (194, 560), (194, 561), (194, 562), (194, 563), (194, 564), (194, 565),
                        (194, 566), (194, 567), (194, 568), (194, 569), (194, 570), (194, 571), (194, 572), (194, 573),
                        (194, 574), (194, 575), (194, 576), (194, 577), (194, 578), (194, 579), (194, 580), (194, 581),
                        (194, 582), (194, 583), (194, 584), (194, 585), (194, 586), (194, 587), (194, 588), (194, 589),
                        (194, 590), (194, 591), (194, 592), (194, 593), (194, 594), (194, 595), (194, 596), (194, 597),
                        (194, 598), (194, 599), (194, 600), (194, 601), (194, 602), (194, 603), (194, 604), (194, 605),
                        (194, 606), (194, 607), (194, 608), (194, 609), (194, 610), (194, 611), (194, 612), (194, 613),
                        (194, 614), (194, 615), (194, 616), (194, 617), (194, 618), (194, 619), (194, 620), (194, 621),
                        (194, 622), (194, 623), (194, 624), (194, 625), (194, 626), (194, 627), (194, 628), (194, 629),
                        (194, 630), (194, 631), (194, 632), (194, 633), (194, 634), (194, 635), (194, 636), (194, 637),
                        (194, 638), (194, 639), (194, 640), (194, 641), (194, 642), (194, 643), (194, 644), (194, 645),
                        (194, 646), (194, 647), (194, 648), (194, 649), (194, 650), (194, 651), (194, 652), (194, 653),
                        (194, 654), (194, 655), (194, 656), (194, 657), (194, 658), (194, 659), (194, 660), (194, 661),
                        (194, 662), (194, 663), (195, 338), (195, 339), (195, 340), (195, 341), (195, 342), (195, 343),
                        (195, 344), (195, 345), (195, 346), (195, 347), (195, 348), (195, 349), (195, 350), (195, 351),
                        (195, 352), (195, 353), (195, 354), (195, 355), (195, 356), (195, 357), (195, 358), (195, 359),
                        (195, 360), (195, 361), (195, 362), (195, 363), (195, 364), (195, 365), (195, 366), (195, 367),
                        (195, 368), (195, 369), (195, 370), (195, 371), (195, 372), (195, 373), (195, 374), (195, 375),
                        (195, 376), (195, 377), (195, 378), (195, 379), (195, 380), (195, 381), (195, 382), (195, 383),
                        (195, 384), (195, 385), (195, 386), (195, 387), (195, 388), (195, 389), (195, 390), (195, 391),
                        (195, 392), (195, 393), (195, 394), (195, 395), (195, 396), (195, 397), (195, 398), (195, 399),
                        (195, 400), (195, 401), (195, 402), (195, 403), (195, 404), (195, 405), (195, 406), (195, 407),
                        (195, 408), (195, 409), (195, 410), (195, 411), (195, 412), (195, 413), (195, 414), (195, 415),
                        (195, 416), (195, 417), (195, 418), (195, 419), (195, 420), (195, 421), (195, 422), (195, 423),
                        (195, 424), (195, 425), (195, 426), (195, 427), (195, 428), (195, 429), (195, 430), (195, 431),
                        (195, 432), (195, 433), (195, 434), (195, 435), (195, 436), (195, 437), (195, 438), (195, 439),
                        (195, 440), (195, 441), (195, 442), (195, 443), (195, 444), (195, 445), (195, 446), (195, 447),
                        (195, 448), (195, 449), (195, 450), (195, 451), (195, 452), (195, 453), (195, 454), (195, 455),
                        (195, 456), (195, 457), (195, 458), (195, 459), (195, 460), (195, 461), (195, 462), (195, 463),
                        (195, 464), (195, 465), (195, 466), (195, 467), (195, 468), (195, 469), (195, 470), (195, 471),
                        (195, 472), (195, 473), (195, 474), (195, 475), (195, 476), (195, 477), (195, 478), (195, 479),
                        (195, 480), (195, 481), (195, 482), (195, 483), (195, 484), (195, 485), (195, 486), (195, 487),
                        (195, 488), (195, 489), (195, 490), (195, 491), (195, 492), (195, 493), (195, 494), (195, 495),
                        (195, 496), (195, 497), (195, 498), (195, 499), (195, 500), (195, 501), (195, 502), (195, 503),
                        (195, 504), (195, 505), (195, 506), (195, 507), (195, 508), (195, 509), (195, 510), (195, 511),
                        (195, 512), (195, 513), (195, 514), (195, 515), (195, 516), (195, 517), (195, 518), (195, 519),
                        (195, 520), (195, 521), (195, 522), (195, 523), (195, 524), (195, 525), (195, 526), (195, 527),
                        (195, 528), (195, 529), (195, 530), (195, 531), (195, 532), (195, 533), (195, 534), (195, 535),
                        (195, 536), (195, 537), (195, 538), (195, 539), (195, 540), (195, 541), (195, 542), (195, 543),
                        (195, 544), (195, 545), (195, 546), (195, 547), (195, 548), (195, 549), (195, 550), (195, 551),
                        (195, 552), (195, 553), (195, 554), (195, 555), (195, 556), (195, 557), (195, 558), (195, 559),
                        (195, 560), (195, 561), (195, 562), (195, 563), (195, 564), (195, 565), (195, 566), (195, 567),
                        (195, 568), (195, 569), (195, 570), (195, 571), (195, 572), (195, 573), (195, 574), (195, 575),
                        (195, 576), (195, 577), (195, 578), (195, 579), (195, 580), (195, 581), (195, 582), (195, 583),
                        (195, 584), (195, 585), (195, 586), (195, 587), (195, 588), (195, 589), (195, 590), (195, 591),
                        (195, 592), (195, 593), (195, 594), (195, 595), (195, 596), (195, 597), (195, 598), (195, 599),
                        (195, 600), (195, 601), (195, 602), (195, 603), (195, 604), (195, 605), (195, 606), (195, 607),
                        (195, 608), (195, 609), (195, 610), (195, 611), (195, 612), (195, 613), (195, 614), (195, 615),
                        (195, 616), (195, 617), (195, 618), (195, 619), (195, 620), (195, 621), (195, 622), (195, 623),
                        (195, 624), (195, 625), (195, 626), (195, 627), (195, 628), (195, 629), (195, 630), (195, 631),
                        (195, 632), (195, 633), (195, 634), (195, 635), (195, 636), (195, 637), (195, 638), (195, 639),
                        (195, 640), (195, 641), (195, 642), (195, 643), (195, 644), (195, 645), (195, 646), (195, 647),
                        (195, 648), (195, 649), (195, 650), (195, 651), (195, 652), (195, 653), (195, 654), (195, 655),
                        (195, 656), (195, 657), (195, 658), (195, 659), (195, 660), (195, 661), (195, 662), (195, 663),
                        (195, 664), (195, 665), (195, 666), (196, 338), (196, 339), (196, 340), (196, 341), (196, 342),
                        (196, 343), (196, 344), (196, 345), (196, 346), (196, 347), (196, 348), (196, 349), (196, 350),
                        (196, 351), (196, 352), (196, 353), (196, 354), (196, 355), (196, 356), (196, 357), (196, 358),
                        (196, 359), (196, 360), (196, 361), (196, 362), (196, 363), (196, 364), (196, 365), (196, 366),
                        (196, 367), (196, 368), (196, 369), (196, 370), (196, 371), (196, 372), (196, 373), (196, 374),
                        (196, 375), (196, 376), (196, 377), (196, 378), (196, 379), (196, 380), (196, 381), (196, 382),
                        (196, 383), (196, 384), (196, 385), (196, 386), (196, 387), (196, 388), (196, 389), (196, 390),
                        (196, 391), (196, 392), (196, 393), (196, 394), (196, 395), (196, 396), (196, 397), (196, 398),
                        (196, 399), (196, 400), (196, 401), (196, 402), (196, 403), (196, 404), (196, 405), (196, 406),
                        (196, 407), (196, 408), (196, 409), (196, 410), (196, 411), (196, 412), (196, 413), (196, 414),
                        (196, 415), (196, 416), (196, 417), (196, 418), (196, 419), (196, 420), (196, 421), (196, 422),
                        (196, 423), (196, 424), (196, 425), (196, 426), (196, 427), (196, 428), (196, 429), (196, 430),
                        (196, 431), (196, 432), (196, 433), (196, 434), (196, 435), (196, 436), (196, 437), (196, 438),
                        (196, 439), (196, 440), (196, 441), (196, 442), (196, 443), (196, 444), (196, 445), (196, 446),
                        (196, 447), (196, 448), (196, 449), (196, 450), (196, 451), (196, 452), (196, 453), (196, 454),
                        (196, 455), (196, 456), (196, 457), (196, 458), (196, 459), (196, 460), (196, 461), (196, 462),
                        (196, 463), (196, 464), (196, 465), (196, 466), (196, 467), (196, 468), (196, 469), (196, 470),
                        (196, 471), (196, 472), (196, 473), (196, 474), (196, 475), (196, 476), (196, 477), (196, 478),
                        (196, 479), (196, 480), (196, 481), (196, 482), (196, 483), (196, 484), (196, 485), (196, 486),
                        (196, 487), (196, 488), (196, 489), (196, 490), (196, 491), (196, 492), (196, 493), (196, 494),
                        (196, 495), (196, 496), (196, 497), (196, 498), (196, 499), (196, 500), (196, 501), (196, 502),
                        (196, 503), (196, 504), (196, 505), (196, 506), (196, 507), (196, 508), (196, 509), (196, 510),
                        (196, 511), (196, 512), (196, 513), (196, 514), (196, 515), (196, 516), (196, 517), (196, 518),
                        (196, 519), (196, 520), (196, 521), (196, 522), (196, 523), (196, 524), (196, 525), (196, 526),
                        (196, 527), (196, 528), (196, 529), (196, 530), (196, 531), (196, 532), (196, 533), (196, 534),
                        (196, 535), (196, 536), (196, 537), (196, 538), (196, 539), (196, 540), (196, 541), (196, 542),
                        (196, 543), (196, 544), (196, 545), (196, 546), (196, 547), (196, 548), (196, 549), (196, 550),
                        (196, 551), (196, 552), (196, 553), (196, 554), (196, 555), (196, 556), (196, 557), (196, 558),
                        (196, 559), (196, 560), (196, 561), (196, 562), (196, 563), (196, 564), (196, 565), (196, 566),
                        (196, 567), (196, 568), (196, 569), (196, 570), (196, 571), (196, 572), (196, 573), (196, 574),
                        (196, 575), (196, 576), (196, 577), (196, 578), (196, 579), (196, 580), (196, 581), (196, 582),
                        (196, 583), (196, 584), (196, 585), (196, 586), (196, 587), (196, 588), (196, 589), (196, 590),
                        (196, 591), (196, 592), (196, 593), (196, 594), (196, 595), (196, 596), (196, 597), (196, 598),
                        (196, 599), (196, 600), (196, 601), (196, 602), (196, 603), (196, 604), (196, 605), (196, 606),
                        (196, 607), (196, 608), (196, 609), (196, 610), (196, 611), (196, 612), (196, 613), (196, 614),
                        (196, 615), (196, 616), (196, 617), (196, 618), (196, 619), (196, 620), (196, 621), (196, 622),
                        (196, 623), (196, 624), (196, 625), (196, 626), (196, 627), (196, 628), (196, 629), (196, 630),
                        (196, 631), (196, 632), (196, 633), (196, 634), (196, 635), (196, 636), (196, 637), (196, 638),
                        (196, 639), (196, 640), (196, 641), (196, 642), (196, 643), (196, 644), (196, 645), (196, 646),
                        (196, 647), (196, 648), (196, 649), (196, 650), (196, 651), (196, 652), (196, 653), (196, 654),
                        (196, 655), (196, 656), (196, 657), (196, 658), (196, 659), (196, 660), (196, 661), (196, 662),
                        (196, 663), (196, 664), (196, 665), (197, 651), (197, 652), (197, 653), (197, 654), (197, 655),
                        (197, 656), (197, 657), (197, 658), (197, 659), (197, 660), (197, 661), (198, 650), (198, 651),
                        (198, 652), (198, 653), (198, 654), (198, 655), (198, 656), (198, 657), (199, 649), (199, 650),
                        (199, 651), (199, 652), (199, 653), (200, 649)]

    line_pixels = [Point(194, 338), Point(194, 339), Point(194, 340), Point(194, 341), Point(194, 342), Point(194, 343),
         Point(194, 344), Point(194, 345), Point(194, 346), Point(194, 347), Point(194, 348), Point(194, 349),
         Point(194, 350), Point(194, 351), Point(194, 352), Point(194, 353), Point(194, 354), Point(194, 355),
         Point(194, 356), Point(194, 357), Point(194, 358), Point(194, 359), Point(194, 360), Point(194, 361),
         Point(194, 362), Point(194, 363), Point(194, 364), Point(194, 365), Point(194, 366), Point(194, 367),
         Point(194, 368), Point(194, 369), Point(194, 370), Point(194, 371), Point(194, 372), Point(194, 373),
         Point(194, 374), Point(194, 375), Point(194, 376), Point(194, 377), Point(194, 378), Point(194, 379),
         Point(194, 380), Point(194, 381), Point(194, 382), Point(194, 383), Point(194, 384), Point(194, 385),
         Point(194, 386), Point(194, 387), Point(194, 388), Point(194, 389), Point(194, 390), Point(194, 391),
         Point(194, 392), Point(194, 393), Point(194, 394), Point(194, 395), Point(194, 396), Point(194, 397),
         Point(194, 398), Point(194, 399), Point(194, 400), Point(194, 401), Point(194, 402), Point(194, 403),
         Point(194, 404), Point(194, 405), Point(194, 406), Point(194, 407), Point(194, 408), Point(194, 409),
         Point(194, 410), Point(194, 411), Point(194, 412), Point(194, 413), Point(194, 414), Point(194, 415),
         Point(194, 416), Point(194, 417), Point(194, 418), Point(194, 419), Point(194, 420), Point(194, 421),
         Point(194, 422), Point(194, 423), Point(194, 424), Point(194, 425), Point(194, 426), Point(194, 427),
         Point(194, 428), Point(194, 429), Point(194, 430), Point(194, 431), Point(194, 432), Point(194, 433),
         Point(194, 434), Point(194, 435), Point(194, 436), Point(194, 437), Point(194, 438), Point(194, 439),
         Point(194, 440), Point(194, 441), Point(194, 442), Point(194, 443), Point(194, 444), Point(194, 445),
         Point(194, 446), Point(194, 447), Point(194, 448), Point(194, 449), Point(194, 450), Point(194, 451),
         Point(194, 452), Point(194, 453), Point(194, 454), Point(194, 455), Point(194, 456), Point(194, 457),
         Point(194, 458), Point(194, 459), Point(194, 460), Point(194, 461), Point(194, 462), Point(194, 463),
         Point(194, 464), Point(194, 465), Point(194, 466), Point(194, 467), Point(194, 468), Point(194, 469),
         Point(194, 470), Point(194, 471), Point(194, 472), Point(194, 473), Point(194, 474), Point(194, 475),
         Point(194, 476), Point(194, 477), Point(194, 478), Point(194, 479), Point(194, 480), Point(194, 481),
         Point(194, 482), Point(194, 483), Point(194, 484), Point(194, 485), Point(194, 486), Point(194, 487),
         Point(194, 488), Point(194, 489), Point(194, 490), Point(194, 491), Point(194, 492), Point(194, 493),
         Point(194, 494), Point(194, 495), Point(194, 496), Point(194, 497), Point(194, 498), Point(194, 499),
         Point(194, 500), Point(194, 501), Point(194, 502), Point(194, 503), Point(194, 504), Point(194, 505),
         Point(194, 506), Point(194, 507), Point(194, 508), Point(194, 509), Point(194, 510), Point(194, 511),
         Point(194, 512), Point(194, 513), Point(194, 514), Point(194, 515), Point(194, 516), Point(194, 517),
         Point(194, 518), Point(194, 519), Point(194, 520), Point(194, 521), Point(194, 522), Point(194, 523),
         Point(194, 524), Point(194, 525), Point(194, 526), Point(194, 527), Point(194, 528), Point(194, 529),
         Point(194, 530), Point(194, 531), Point(194, 532), Point(194, 533), Point(194, 534), Point(194, 535),
         Point(194, 536), Point(194, 537), Point(194, 538), Point(194, 539), Point(194, 540), Point(194, 541),
         Point(194, 542), Point(194, 543), Point(194, 544), Point(194, 545), Point(194, 546), Point(194, 547),
         Point(194, 548), Point(194, 549), Point(194, 550), Point(194, 551), Point(194, 552), Point(194, 553),
         Point(194, 554), Point(194, 555), Point(194, 556), Point(194, 557), Point(194, 558), Point(194, 559),
         Point(194, 560), Point(194, 561), Point(194, 562), Point(194, 563), Point(194, 564), Point(194, 565),
         Point(194, 566), Point(194, 567), Point(194, 568), Point(194, 569), Point(194, 570), Point(194, 571),
         Point(194, 572), Point(194, 573), Point(194, 574), Point(194, 575), Point(194, 576), Point(194, 577),
         Point(194, 578), Point(194, 579), Point(194, 580), Point(194, 581), Point(194, 582), Point(194, 583),
         Point(194, 584), Point(194, 585), Point(194, 586), Point(194, 587), Point(194, 588), Point(194, 589),
         Point(194, 590), Point(194, 591), Point(194, 592), Point(194, 593), Point(194, 594), Point(194, 595),
         Point(194, 596), Point(194, 597), Point(194, 598), Point(194, 599), Point(194, 600), Point(194, 601),
         Point(194, 602), Point(194, 603), Point(194, 604), Point(194, 605), Point(194, 606), Point(194, 607),
         Point(194, 608), Point(194, 609), Point(194, 610), Point(194, 611), Point(194, 612), Point(194, 613),
         Point(194, 614), Point(194, 615), Point(194, 616), Point(194, 617), Point(194, 618), Point(194, 619),
         Point(194, 620), Point(194, 621), Point(194, 622), Point(194, 623), Point(194, 624), Point(194, 625),
         Point(194, 626), Point(194, 627), Point(194, 628), Point(194, 629), Point(194, 630), Point(194, 631),
         Point(194, 632), Point(194, 633), Point(194, 634), Point(194, 635), Point(194, 636), Point(194, 637),
         Point(194, 638), Point(194, 639), Point(194, 640), Point(194, 641), Point(194, 642), Point(194, 643),
         Point(194, 644), Point(194, 645), Point(194, 646), Point(194, 647), Point(194, 648), Point(194, 649),
         Point(194, 650), Point(194, 651), Point(194, 652), Point(194, 653), Point(194, 654), Point(194, 655),
         Point(194, 656), Point(194, 657), Point(194, 658), Point(194, 659), Point(194, 660), Point(194, 661),
         Point(194, 662), Point(194, 663)]
    arrow = SolidArrow(pixels=arrow_pixels, line=Line(line_pixels
        ))
    panel = arrow.panel
    structures = set(structures).difference([panel])
    line = arrow.line
    left, right = extend_line(line)
    max_initial_distance = np.mean([np.sqrt(cc.area) for cc in structures])
    reactants = find_nearby_ccs(left, structures, max_initial_distance)
    products = find_nearby_ccs(right, structures, max_initial_distance)
    assert frozenset(products) == frozenset([Panel(left=767, right=953, top=177, bottom=312),
                                             Panel(left=679, right=888, top=23, bottom=115),
                                             Panel(left=805, right=888, top=385, bottom=407)])
    assert frozenset(reactants) == frozenset([Panel(left=0, right=129, top=144, bottom=237),
                                              Panel(left=228, right=279, top=158, bottom=229)])


def test_match_function_and_smiles():
    smiles = ([(['1c-Br2 92% yield, >99%ee'], 'Brc1ccc2c(c3c4ccc(Br)cc4ccc3O)c(O)ccc2c1'),
               (['1c (05 mmol)'],'c1ccc2c(c3c4ccccc4ccc3O)c(O)ccc2c1'),
               (['NBS (2 6 equiv)'], 'C1(=O)N(C(=O)CC1)Br')],
              [Rect(left=711, right=948, top=0, bottom=200),
               Rect(left=0, right=186, top=6, bottom=193),
               Rect(left=260, right=376, top=29, bottom=176)])


    reactants = [Reactant(Rect (0, 186, 6, 193)), Reactant(Rect(260, 376, 29, 176))]
    products = [Product(Rect(711, 948, 0, 200))]
    reaction_step = ReactionStep(None, reactants, products, None)
    cc1 = smiles[1][0]


    match_function_and_smiles(reaction_step, smiles)

    assert reactants[0].smiles == 'c1ccc2c(c3c4ccccc4ccc3O)c(O)ccc2c1'
    assert reactants[0].label == ['1c (05 mmol)']

    assert reactants[1].smiles == 'C1(=O)N(C(=O)CC1)Br'
    assert reactants[1].label == ['NBS (2 6 equiv)']

    assert products[0].smiles == 'Brc1ccc2c(c3c4ccc(Br)cc4ccc3O)c(O)ccc2c1'
    assert products[0].label == ['1c-Br2 92% yield, >99%ee']


if __name__ == '__main__':
    test_extend_line_horizontal()
    test_extend_line_vertical()
    test_extend_line_slope1()
    test_find_nearby_ccs_structures()
    # test_match_function_and_smiles()
